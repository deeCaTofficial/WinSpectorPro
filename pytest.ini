# ===================================================================
# Конфигурация Pytest для проекта WinSpector Pro v1.0.0
# ===================================================================

[pytest]

# --- Основные настройки ---
# Пути для импорта: позволяет тестам видеть модули из папки 'src'
pythonpath = . src
# Директория для поиска тестов
testpaths = tests
# Минимальная требуемая версия pytest
minversion = 7.0


# --- Настройки выполнения и вывода ---
# -ra:              показывать детальный отчет для всех тестов, кроме успешных
# -q:               более тихий вывод, меньше "мусора"
# --strict-markers: вызывать ошибку при использовании незарегистрированных маркеров
# --color=yes:      всегда использовать цветной вывод
addopts = -ra -q --strict-markers --color=yes


# --- Фильтрация предупреждений ---
# Игнорируем特定ные предупреждения, которые не являются критичными
filterwarnings =
    # Игнорируем предупреждения об устаревании из некоторых библиотек
    ignore::DeprecationWarning
    # Можно добавить другие фильтры по необходимости


# --- Настройки логирования ---
# Включаем вывод логов в консоль во время выполнения тестов
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s:%(lineno)d: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S


# --- Регистрация кастомных маркеров ---
markers =
    asyncio: помечает тесты как асинхронные (для pytest-asyncio)
    slow: помечает тесты, которые выполняются долго
    gui: помечает тесты, требующие взаимодействия с GUI (PyQt)
    api: помечает тесты, которые делают реальные запросы к внешним API


# --- Настройки для плагинов ---

# Режим для pytest-asyncio
asyncio_mode = auto

# Настройки для pytest-cov (отчеты о покрытии)
cov_paths = src/winspector
cov_report =
    term-missing:skip-covered
    html
cov_omit =
    # Исключаем файлы, которые сложно или не нужно тестировать
    src/winspector/__main__.py
    src/winspector/application.py
    src/winspector/gui/*
    */__init__.py
# Раскомментируйте, чтобы требовать минимальный уровень покрытия
# cov_fail_under = 80